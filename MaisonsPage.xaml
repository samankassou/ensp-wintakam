<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Wintakam.Converters"
             x:Class="Wintakam.MaisonsPage"
             BackgroundColor="White"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="True">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:FavoriConverter x:Key="FavoriConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,*,Auto">

        <!-- En-tÃªte avec localisation et recherche -->
        <Grid Grid.Row="0"
              Padding="20,20,20,10"
              ColumnDefinitions="Auto,*,Auto">

            <!-- Localisation -->
            <VerticalStackLayout Grid.Column="0" Spacing="2">
                <HorizontalStackLayout Spacing="5">
                    <Image Source="location_icon.png"
                           WidthRequest="20"
                           HeightRequest="20"
                           VerticalOptions="Center"/>
                    <Label Text="Localisation"
                           FontFamily="Roboto"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource WintakamTeal}"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="5" Margin="25,0,0,0">
                    <Label Text="Sud , Kribi"
                           FontFamily="Roboto"
                           FontSize="14"
                           TextColor="{StaticResource WintakamGray}"
                           VerticalOptions="Center"/>
                    <Label Text="â–¼"
                           FontFamily="Roboto"
                           FontSize="10"
                           TextColor="{StaticResource WintakamGray}"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>

            <!-- Bouton de recherche -->
            <ImageButton Grid.Column="2"
                        Source="search_icon.png"
                        WidthRequest="24"
                        HeightRequest="24"
                        BackgroundColor="Transparent"
                        VerticalOptions="Center"
                        Clicked="OnSearchClicked"/>
        </Grid>

        <!-- Barre de filtres -->
        <Grid Grid.Row="1"
              Padding="20,10"
              ColumnDefinitions="Auto,*,Auto,Auto,Auto">

            <!-- Titre Maisons -->
            <Label Grid.Column="0"
                   Text="Maisons"
                   FontFamily="Roboto"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="Black"
                   VerticalOptions="Center"/>

            <!-- Filtre Vente -->
            <Border Grid.Column="2"
                    StrokeThickness="1"
                    Stroke="{StaticResource Gray300}"
                    BackgroundColor="White"
                    Padding="12,6"
                    Margin="0,0,10,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>

                <HorizontalStackLayout Spacing="5">
                    <Label Text="Vente"
                           FontFamily="Roboto"
                           FontSize="14"
                           TextColor="{StaticResource WintakamGray}"
                           VerticalOptions="Center"/>
                    <Label Text="â–¼"
                           FontFamily="Roboto"
                           FontSize="10"
                           TextColor="{StaticResource WintakamGray}"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </Border>

            <!-- Filtre Tri -->
            <Border Grid.Column="3"
                    StrokeThickness="1"
                    Stroke="{StaticResource Gray300}"
                    BackgroundColor="White"
                    Padding="12,6"
                    Margin="0,0,10,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>

                <HorizontalStackLayout Spacing="5">
                    <Label Text="Tri"
                           FontFamily="Roboto"
                           FontSize="14"
                           TextColor="{StaticResource WintakamGray}"
                           VerticalOptions="Center"/>
                    <Label Text="â–¼"
                           FontFamily="Roboto"
                           FontSize="10"
                           TextColor="{StaticResource WintakamGray}"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </Border>

            <!-- Bouton filtre avancÃ© -->
            <ImageButton Grid.Column="4"
                        Source="filter_icon.png"
                        WidthRequest="24"
                        HeightRequest="24"
                        BackgroundColor="Transparent"
                        VerticalOptions="Center"
                        Clicked="OnFilterClicked"/>
        </Grid>

        <!-- Liste des maisons -->
        <ScrollView Grid.Row="2" Padding="15,0">
            <CollectionView x:Name="MaisonsCollectionView"
                           SelectionMode="None">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                    Span="2"
                                    HorizontalItemSpacing="15"
                                    VerticalItemSpacing="20"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid RowDefinitions="200,Auto,Auto,Auto"
                              RowSpacing="8">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMaisonTapped"
                                                     CommandParameter="{Binding .}"/>
                            </Grid.GestureRecognizers>

                            <!-- Image de la maison -->
                            <Border Grid.Row="0"
                                   StrokeThickness="0"
                                   BackgroundColor="{StaticResource Gray100}">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12"/>
                                </Border.StrokeShape>

                                <Grid>
                                    <Image Source="{Binding Image}"
                                          Aspect="AspectFill"/>

                                    <!-- Badge Nouveau en haut Ã  droite -->
                                    <Border IsVisible="{Binding EstNouveau}"
                                           BackgroundColor="White"
                                           StrokeThickness="0"
                                           Padding="8,4"
                                           HorizontalOptions="End"
                                           VerticalOptions="Start"
                                           Margin="10">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>

                                        <Label Text="ðŸ "
                                              FontSize="14"/>
                                    </Border>

                                    <!-- Bouton favori en bas Ã  droite -->
                                    <Border BackgroundColor="White"
                                           StrokeThickness="0"
                                           WidthRequest="36"
                                           HeightRequest="36"
                                           HorizontalOptions="End"
                                           VerticalOptions="End"
                                           Margin="10">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="18"/>
                                        </Border.StrokeShape>

                                        <Label Text="{Binding EstFavori, Converter={StaticResource FavoriConverter}}"
                                              FontSize="18"
                                              HorizontalOptions="Center"
                                              VerticalOptions="Center"/>
                                    </Border>
                                </Grid>
                            </Border>

                            <!-- Nom de la maison avec bouton + -->
                            <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                      Text="{Binding Nom}"
                                      FontFamily="Roboto"
                                      FontSize="16"
                                      FontAttributes="Bold"
                                      TextColor="Black"
                                      VerticalOptions="Center"/>

                                <Label Grid.Column="1"
                                      Text="+"
                                      FontFamily="Roboto"
                                      FontSize="20"
                                      FontAttributes="Bold"
                                      TextColor="{StaticResource WintakamTeal}"
                                      VerticalOptions="Center"/>
                            </Grid>

                            <!-- Informations (chambres et superficie) -->
                            <HorizontalStackLayout Grid.Row="2" Spacing="10">
                                <HorizontalStackLayout Spacing="5">
                                    <Image Source="bed_icon.png"
                                          WidthRequest="16"
                                          HeightRequest="16"
                                          VerticalOptions="Center"/>
                                    <Label Text="{Binding NombreChambres}"
                                          FontFamily="Roboto"
                                          FontSize="12"
                                          TextColor="{StaticResource Gray500}"
                                          VerticalOptions="Center"/>
                                    <Label Text="Chambres"
                                          FontFamily="Roboto"
                                          FontSize="12"
                                          TextColor="{StaticResource Gray500}"
                                          VerticalOptions="Center"/>
                                </HorizontalStackLayout>

                                <HorizontalStackLayout Spacing="5">
                                    <Image Source="area_icon.png"
                                          WidthRequest="16"
                                          HeightRequest="16"
                                          VerticalOptions="Center"/>
                                    <Label FontFamily="Roboto"
                                          FontSize="12"
                                          TextColor="{StaticResource Gray500}"
                                          VerticalOptions="Center">
                                        <Label.Text>
                                            <MultiBinding StringFormat="{}{0} m2">
                                                <Binding Path="Superficie"/>
                                            </MultiBinding>
                                        </Label.Text>
                                    </Label>
                                </HorizontalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Prix -->
                            <Label Grid.Row="3"
                                  Text="{Binding Prix}"
                                  FontFamily="Roboto"
                                  FontSize="16"
                                  FontAttributes="Bold"
                                  TextColor="{StaticResource WintakamTeal}"/>

                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <!-- Barre de navigation infÃ©rieure -->
        <Grid Grid.Row="3"
              BackgroundColor="White"
              Padding="0,10,0,20"
              ColumnDefinitions="*,*,*,*,*"
              ColumnSpacing="0">

            <!-- Accueil -->
            <VerticalStackLayout Grid.Column="0"
                                Spacing="4"
                                HorizontalOptions="Center">
                <Image Source="home_icon.png"
                      WidthRequest="24"
                      HeightRequest="24"/>
                <Label Text="Accueil"
                      FontFamily="Roboto"
                      FontSize="11"
                      TextColor="{StaticResource Gray500}"
                      HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Favoris -->
            <VerticalStackLayout Grid.Column="1"
                                Spacing="4"
                                HorizontalOptions="Center">
                <Image Source="favorite_icon.png"
                      WidthRequest="24"
                      HeightRequest="24"/>
                <Label Text="Favoris"
                      FontFamily="Roboto"
                      FontSize="11"
                      TextColor="{StaticResource Gray500}"
                      HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Menu -->
            <VerticalStackLayout Grid.Column="2"
                                Spacing="4"
                                HorizontalOptions="Center">
                <Image Source="menu_icon.png"
                      WidthRequest="24"
                      HeightRequest="24"/>
                <Label Text="Menu"
                      FontFamily="Roboto"
                      FontSize="11"
                      TextColor="{StaticResource Gray500}"
                      HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Ã‰vÃ©nements -->
            <VerticalStackLayout Grid.Column="3"
                                Spacing="4"
                                HorizontalOptions="Center">
                <Image Source="events_icon.png"
                      WidthRequest="24"
                      HeightRequest="24"/>
                <Label Text="Ã‰vÃ©nements"
                      FontFamily="Roboto"
                      FontSize="11"
                      TextColor="{StaticResource Gray500}"
                      HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Compte -->
            <VerticalStackLayout Grid.Column="4"
                                Spacing="4"
                                HorizontalOptions="Center">
                <Image Source="account_icon.png"
                      WidthRequest="24"
                      HeightRequest="24"/>
                <Label Text="Compte"
                      FontFamily="Roboto"
                      FontSize="11"
                      TextColor="{StaticResource Gray500}"
                      HorizontalOptions="Center"/>
            </VerticalStackLayout>

        </Grid>

    </Grid>

</ContentPage>
